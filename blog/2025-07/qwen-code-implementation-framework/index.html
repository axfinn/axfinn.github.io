<!DOCTYPE html>
<html lang="zn-Hans">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=1" />
  
  <meta name="author" content="jaxiu He">
  <meta name="description"
    content="Qwen Code 实现框架深度解析
引言
Qwen Code 是一个基于 AI 的命令行工具，它将大型语言模型的能力与本地开发环境相结合。为了实现这一目标，Qwen Code 采用了复杂而精巧的实现框架，涉及多个技术领域。本文将深入解析 Qwen Code 的实现框架，帮助读者理解其内部工作机制。
整体架构
Qwen Code 的整体架构可以分为以下几个主要层次：

用户接口层：提供命令行交互界面
核心逻辑层：处理用户请求和 AI 模型交互
工具执行层：执行各种本地操作工具
模型接口层：与 Qwen 模型进行通信
安全管理层：确保操作的安全性

┌─────────────────────────────────────┐
│           用户接口层                 │
│         (CLI 界面)                  │
├─────────────────────────────────────┤
│           核心逻辑层                 │
│    (请求处理、响应生成)              │
├─────────────────────────────────────┤
│          工具执行层                  │
│  (文件系统、网络、命令执行等工具)     │
├─────────────────────────────────────┤
│          模型接口层                  │
│      (与 Qwen 模型通信)              │
├─────────────────────────────────────┤
│          安全管理层                  │
│    (权限控制、沙箱隔离等)            │
└─────────────────────────────────────┘
为了更直观地理解整体架构，我们可以用 Mermaid 绘制一个架构图：">

  <meta property="og:url" content="https://blog.jaxiu.cn/blog/2025-07/qwen-code-implementation-framework/">
  <meta property="og:site_name" content="jaxiu He">
  <meta property="og:title" content="Qwen Code 实现框架深度解析">
  <meta property="og:description" content="Qwen Code 实现框架深度解析 引言 Qwen Code 是一个基于 AI 的命令行工具，它将大型语言模型的能力与本地开发环境相结合。为了实现这一目标，Qwen Code 采用了复杂而精巧的实现框架，涉及多个技术领域。本文将深入解析 Qwen Code 的实现框架，帮助读者理解其内部工作机制。
整体架构 Qwen Code 的整体架构可以分为以下几个主要层次：
用户接口层：提供命令行交互界面 核心逻辑层：处理用户请求和 AI 模型交互 工具执行层：执行各种本地操作工具 模型接口层：与 Qwen 模型进行通信 安全管理层：确保操作的安全性 ┌─────────────────────────────────────┐ │ 用户接口层 │ │ (CLI 界面) │ ├─────────────────────────────────────┤ │ 核心逻辑层 │ │ (请求处理、响应生成) │ ├─────────────────────────────────────┤ │ 工具执行层 │ │ (文件系统、网络、命令执行等工具) │ ├─────────────────────────────────────┤ │ 模型接口层 │ │ (与 Qwen 模型通信) │ ├─────────────────────────────────────┤ │ 安全管理层 │ │ (权限控制、沙箱隔离等) │ └─────────────────────────────────────┘ 为了更直观地理解整体架构，我们可以用 Mermaid 绘制一个架构图：">
  <meta property="og:locale" content="zn_Hans">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2025-07-23T15:55:00+08:00">
    <meta property="article:modified_time" content="2025-07-23T15:55:00+08:00">
    <meta property="article:tag" content="Qwen Code">
    <meta property="article:tag" content="架构设计">
    <meta property="article:tag" content="实现原理">
    <meta property="article:tag" content="源码解析">


  <title>
    
     Qwen Code 实现框架深度解析 | jaxiu He 
    
  </title>

  <link rel="canonical" href="https://blog.jaxiu.cn/blog/2025-07/qwen-code-implementation-framework/">

  
  

  
  
  
  <meta name="baidu-site-verification" content="your-baidu-verify-code" />
  

  
  
  <meta name="google-site-verification" content="your-google-verify-code" />
  

  
  <link href="https://blog.jaxiu.cn/css/vendors-extensions/fontawesome/all.min.css" rel="stylesheet">

  
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:300,400,500,600">
  <link href="https://blog.jaxiu.cn/css/font.css" rel="stylesheet">

  
  <link href="https://blog.jaxiu.cn/css/vendors/bootstrap4/bootstrap.min.css" rel="stylesheet">
  <link href="https://blog.jaxiu.cn/css/vendors-extensions/mdb/mdb.min.css" rel="stylesheet">
  <link href="https://blog.jaxiu.cn/css/vendors/mdb/style.min.css" rel="stylesheet">
  <link href="https://blog.jaxiu.cn/css/main.css" rel="stylesheet">


  
  <link rel="shortcut icon"  href="https://blog.jaxiu.cn/img/logo.png" >


  
  

  <style type="text/css">
    @media (min-width: 800px) and (max-width: 850px) {
      .navbar:not(.top-nav-collapse) {
        background: #1C2331 !important;
      }
    }
  </style>


  
  
  <link rel="stylesheet" href="https://blog.jaxiu.cn/js/vendors/katex/katex.min.css">
  
  

  
  
  <link rel="stylesheet" href="https://blog.jaxiu.cn/css/vendors/highlight/github-gist.css">
  

  
  
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script>
  
  

  
  <link href="https://blog.jaxiu.cn/css/holiday-effects.css" rel="stylesheet">
  <script src="https://blog.jaxiu.cn/js/holiday-effects.js"></script>

  
  <script src="https://blog.jaxiu.cn/js/dynamic-bg.js"></script>
  <link href="https://blog.jaxiu.cn/css/dynamic-bg-control.css" rel="stylesheet">

</head>
  <body class="bg-light" data-spy="scroll" data-target="#page-scrollspy" data-offset="90">
  
    
    

    
      


<nav class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar">
    <div class="container">

        
        <a class="navbar-brand" href="https://blog.jaxiu.cn/">
            
            <img class="avatar" src="https://blog.jaxiu.cn/img/logo.png"
                style="width: 40px!important;height: auto;" class="d-inline-block align-top" alt="">
            
            <strong> jaxiu He</strong>
        </a>

        
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            
            <ul class="navbar-nav mr-auto ">
                <li class="nav-item ">
                    <a class="nav-link" href="https://blog.jaxiu.cn/">Home</a>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link" href="https://blog.jaxiu.cn/blog/">博客  </a>
                </li>

                
                <li class="nav-item ">
                    <a class="nav-link" href="https://blog.jaxiu.cn/moment/">动态  </a>
                </li>

                
                <li class="nav-item ">
                    <a class="nav-link" href="https://blog.jaxiu.cn/about/">关于  </a>
                </li>

                
            </ul>

        </div>

    </div>
</nav>
 
      







<div id="site-header" class="carousel slide carousel-fade" data-ride="carousel" style="height: 18rem;">
  

  
  
  

  
  <div class="carousel-inner" role="listbox">
    
    

    
    <div class="carousel-item active">
      <div class="view"
        style="background-image: url('https://blog.jaxiu.cn/img/header-slides/raw_1515691746.jpg'); background-repeat: no-repeat; background-size: cover;">

        
        <div class="mask rgba-black-light d-flex justify-content-center align-items-center">

          
          
          

        </div>
        

      </div>
    </div>
    
    
    
    

    
    <div class="carousel-item">
      <div class="view"
        style="background-image: url('https://blog.jaxiu.cn/img/header-slides//raw_1515847341.jpg'); background-repeat: no-repeat; background-size: cover;">

        
        <div class="mask rgba-black-light d-flex justify-content-center align-items-center">



        </div>
        

      </div>
    </div>
    
    
    


  </div>
  

  
  <div class="carousel-content text-center white-text wow fadeIn">
    <div class="row mx-0 headfont mt-3 pt-4">
      
      <div class="col-12 col-sm-5 align-middle">
        <a href="https://blog.jaxiu.cn/">
          
          <img class="pull-right avatar avatar-md" src="https://blog.jaxiu.cn/img/logo.png" alt="">
          
        </a>
      </div>

      <div class="col-12 col-sm-7 text-left pl-2">
        <a href="https://blog.jaxiu.cn/">
          <h1 class="mb-2 h1" style="font-weight: 300;">
            <strong>jaxiu He</strong>
          </h1>
        </a>


        
        <div class="mt-2" style="font-size: 1rem; color: white;">
          
          <a href="//github.com/axfinn" target="_blank" rel="noopener"><i class="fab fa-github pr-1"
              aria-hidden="true"></i></a>
          
          

          

          

          

          

          


          
          <a href="mailto:521very@email.com"><i class="far fa-envelope-open pr-1" aria-hidden="true"></i></a>
          

          


        </div>
      </div>
    </div>
  </div>
  

  
  
  

</div>
  
    

    
  
  <main class="post-main-wrapper">
    
    
    <div class="row">

      

      
      <div class="container pr-5">
      

        
        <div class="z-depth-1  post-wrapper white-bg single-post">

          <div class="post-header text-center" >
  <ul class="post-meta li-x">
    
      
        <li><a href="https://blog.jaxiu.cn/categories/%E6%8A%80%E6%9C%AF"><i class="fas fa-folder-open pr-1" aria-hidden="true"></i> 技术 </a></li>
      
        <li><a href="https://blog.jaxiu.cn/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><i class="fas fa-folder-open pr-1" aria-hidden="true"></i> 架构设计 </a></li>
      
    
    
  </ul>

  <div class="px-4 post-heading">Qwen Code 实现框架深度解析</div>

  <ul class="post-meta li-x mt-1">
    
      <li>Jul 23, 2025</li>
    

    
      <li class="middot"></li>
      <li>7 minutes read</li>
    
  </ul>
  

</div>


          <div class="post-content markdown">
            <h1 id="qwen-code-实现框架深度解析">Qwen Code 实现框架深度解析</h1>
<h2 id="引言">引言</h2>
<p>Qwen Code 是一个基于 AI 的命令行工具，它将大型语言模型的能力与本地开发环境相结合。为了实现这一目标，Qwen Code 采用了复杂而精巧的实现框架，涉及多个技术领域。本文将深入解析 Qwen Code 的实现框架，帮助读者理解其内部工作机制。</p>
<h2 id="整体架构">整体架构</h2>
<p>Qwen Code 的整体架构可以分为以下几个主要层次：</p>
<ol>
<li><strong>用户接口层</strong>：提供命令行交互界面</li>
<li><strong>核心逻辑层</strong>：处理用户请求和 AI 模型交互</li>
<li><strong>工具执行层</strong>：执行各种本地操作工具</li>
<li><strong>模型接口层</strong>：与 Qwen 模型进行通信</li>
<li><strong>安全管理层</strong>：确保操作的安全性</li>
</ol>
<pre tabindex="0"><code>┌─────────────────────────────────────┐
│           用户接口层                 │
│         (CLI 界面)                  │
├─────────────────────────────────────┤
│           核心逻辑层                 │
│    (请求处理、响应生成)              │
├─────────────────────────────────────┤
│          工具执行层                  │
│  (文件系统、网络、命令执行等工具)     │
├─────────────────────────────────────┤
│          模型接口层                  │
│      (与 Qwen 模型通信)              │
├─────────────────────────────────────┤
│          安全管理层                  │
│    (权限控制、沙箱隔离等)            │
└─────────────────────────────────────┘
</code></pre><p>为了更直观地理解整体架构，我们可以用 Mermaid 绘制一个架构图：</p>
<div class="mermaid">

graph TD
    A[用户接口层] --> B[核心逻辑层]
    B --> C[工具执行层]
    B --> D[模型接口层]
    B --> E[安全管理层]
    
    A -->|用户输入| B
    B -->|工具调用| C
    B -->|模型请求| D
    B -->|安全检查| E
    C -->|执行结果| B
    D -->|模型响应| B
    E -->|权限验证| B
    B -->|输出结果| A

</div>
<h2 id="用户接口层实现">用户接口层实现</h2>
<h3 id="cli-界面构建">CLI 界面构建</h3>
<p>Qwen Code 的 CLI 界面基于 React 和 Ink 构建，这使得它能够提供富文本的命令行体验。</p>
<p>关键组件：</p>
<ol>
<li><strong>主应用组件</strong>：管理整个 CLI 应用的生命周期</li>
<li><strong>输入组件</strong>：处理用户输入</li>
<li><strong>输出组件</strong>：显示 AI 响应和工具执行结果</li>
<li><strong>状态组件</strong>：显示当前操作状态</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// packages/cli/src/gemini.tsx (简化版)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Box</span><span class="p">,</span> <span class="nx">Text</span><span class="p">,</span> <span class="nx">useInput</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;ink&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">App</span>: <span class="kt">React.FC</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[</span><span class="nx">input</span><span class="p">,</span> <span class="nx">setInput</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[</span><span class="nx">output</span><span class="p">,</span> <span class="nx">setOutput</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="nx">useInput</span><span class="p">((</span><span class="nx">char</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">char</span> <span class="o">===</span> <span class="s1">&#39;\r&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 处理回车键，发送请求到核心逻辑层
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">handleSubmit</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">setInput</span><span class="p">(</span><span class="nx">prev</span> <span class="o">=&gt;</span> <span class="nx">prev</span> <span class="o">+</span> <span class="nx">char</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">handleSubmit</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">query</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 调用核心逻辑层处理请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">core</span><span class="p">.</span><span class="nx">processQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">setOutput</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">Box</span> <span class="na">flexDirection</span><span class="o">=</span><span class="s">&#34;column&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">Text</span><span class="p">&gt;</span><span class="nx">Qwen</span> <span class="nx">Code</span> <span class="nx">CLI</span><span class="p">&lt;/</span><span class="nt">Text</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">Text</span> <span class="na">color</span><span class="o">=</span><span class="s">&#34;green&#34;</span><span class="p">&gt;{</span><span class="nx">output</span><span class="p">}&lt;/</span><span class="nt">Text</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">Text</span> <span class="na">color</span><span class="o">=</span><span class="s">&#34;blue&#34;</span><span class="p">&gt;</span><span class="o">&gt;</span> <span class="p">{</span><span class="nx">input</span><span class="p">}&lt;/</span><span class="nt">Text</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">Box</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><h3 id="命令行参数解析">命令行参数解析</h3>
<p>使用 <code>commander.js</code> 库处理命令行参数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// packages/cli/src/cli.ts (简化版)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Command</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;commander&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">version</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;../../package.json&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">program</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Command</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">program</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">version</span><span class="p">(</span><span class="nx">version</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;-c, --config &lt;path&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;配置文件路径&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;-t, --theme &lt;name&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;主题名称&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="kr">async</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 初始化应用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">await</span> <span class="nx">initializeApp</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">program</span><span class="p">.</span><span class="nx">parse</span><span class="p">();</span>
</span></span></code></pre></div><h2 id="核心逻辑层实现">核心逻辑层实现</h2>
<h3 id="请求处理流程">请求处理流程</h3>
<p>核心逻辑层负责处理用户请求，其主要流程如下：</p>
<ol>
<li><strong>请求接收</strong>：接收来自用户接口层的请求</li>
<li><strong>上下文构建</strong>：构建包含历史对话和工具信息的上下文</li>
<li><strong>模型调用</strong>：调用模型接口层与 Qwen 模型交互</li>
<li><strong>响应处理</strong>：处理模型返回的响应</li>
<li><strong>工具执行</strong>：根据需要执行工具</li>
<li><strong>结果返回</strong>：将最终结果返回给用户接口层</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// packages/core/src/core/processor.ts (简化版)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">class</span> <span class="nx">RequestProcessor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="nx">processQuery</span><span class="p">(</span><span class="nx">query</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">string</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 1. 构建上下文
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">buildContext</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 2. 调用模型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">modelInterface</span><span class="p">.</span><span class="nx">callModel</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 3. 处理响应
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">processedResponse</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleResponse</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 4. 执行工具（如果需要）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">processedResponse</span><span class="p">.</span><span class="nx">toolCalls</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">toolResults</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">executeTools</span><span class="p">(</span><span class="nx">processedResponse</span><span class="p">.</span><span class="nx">toolCalls</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 将工具结果反馈给模型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kr">const</span> <span class="nx">finalResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">modelInterface</span><span class="p">.</span><span class="nx">callModelWithTools</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nx">context</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">        <span class="nx">toolResults</span>
</span></span><span class="line"><span class="cl">      <span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">finalResponse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">processedResponse</span><span class="p">.</span><span class="nx">text</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>请求处理流程可以用下图表示：</p>
<div class="mermaid">

flowchart TD
    A[用户输入] --> B[请求接收]
    B --> C[上下文构建]
    C --> D[模型调用]
    D --> E[响应处理]
    E --> F{是否有工具调用?}
    F -->|是| G[工具执行]
    G --> H[工具结果反馈给模型]
    H --> I[最终响应]
    F -->|否| I
    I --> J[结果返回给用户]

</div>
<h3 id="上下文管理">上下文管理</h3>
<p>为了维持对话的连贯性，Qwen Code 实现了上下文管理机制：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// packages/core/src/core/context.ts (简化版)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">class</span> <span class="nx">ContextManager</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">history</span>: <span class="kt">Array</span><span class="o">&lt;</span><span class="p">{</span><span class="nx">role</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">content</span>: <span class="kt">string</span><span class="p">}</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="nx">addMessage</span><span class="p">(</span><span class="nx">role</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">content</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">role</span><span class="p">,</span> <span class="nx">content</span><span class="p">});</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 限制历史记录长度，避免超出模型上下文限制
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">MAX_HISTORY_LENGTH</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="nx">getHistory</span><span class="p">()</span><span class="o">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="p">{</span><span class="nx">role</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">content</span>: <span class="kt">string</span><span class="p">}</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[...</span><span class="k">this</span><span class="p">.</span><span class="nx">history</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="nx">clear() {</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">history</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="工具执行层实现">工具执行层实现</h2>
<h3 id="工具接口设计">工具接口设计</h3>
<p>所有工具都实现统一的接口，确保一致性和可扩展性：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// packages/core/src/tools/tool.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="kr">interface</span> <span class="nx">Tool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">description</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">parameters</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="nx">key</span>: <span class="kt">string</span><span class="p">]</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">type</span><span class="o">:</span> <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">description</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">required</span>: <span class="kt">boolean</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="nx">execute</span><span class="o">:</span> <span class="p">(</span><span class="nx">params</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 工具注册
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="kr">const</span> <span class="nx">tools</span>: <span class="kt">Tool</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="nx">readFileTool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">writeFileTool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">listDirectoryTool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ... 其他工具
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">];</span>
</span></span></code></pre></div><h3 id="文件系统工具实现">文件系统工具实现</h3>
<p>以 <code>readFile</code> 工具为例，展示工具实现细节：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// packages/core/src/tools/readFile.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Tool</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./tool&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">promises</span> <span class="kr">as</span> <span class="nx">fs</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;fs&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">path</span> <span class="kr">from</span> <span class="s1">&#39;path&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">readFileTool</span>: <span class="kt">Tool</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;read_file&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">description</span><span class="o">:</span> <span class="s1">&#39;读取文件内容&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">parameters</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">absolute_path</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">type</span><span class="o">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">description</span><span class="o">:</span> <span class="s1">&#39;文件的绝对路径&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">required</span>: <span class="kt">true</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">limit</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">type</span><span class="o">:</span> <span class="s1">&#39;number&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">description</span><span class="o">:</span> <span class="s1">&#39;可选，要读取的最大行数&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">required</span>: <span class="kt">false</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">offset</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">type</span><span class="o">:</span> <span class="s1">&#39;number&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">description</span><span class="o">:</span> <span class="s1">&#39;可选，开始读取的行偏移量&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">required</span>: <span class="kt">false</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">execute</span>: <span class="kt">async</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 验证路径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">path</span><span class="p">.</span><span class="nx">isAbsolute</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">absolute_path</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;路径必须是绝对路径&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">      <span class="c1">// 读取文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kr">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">absolute_path</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">      <span class="c1">// 处理分页参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">limit</span> <span class="o">||</span> <span class="nx">params</span><span class="p">.</span><span class="nx">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">lines</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">offset</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">end</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">limit</span> <span class="o">?</span> <span class="nx">start</span> <span class="o">+</span> <span class="nx">params.limit</span> : <span class="kt">lines.length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="sb">`读取文件失败: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><h3 id="工具执行机制">工具执行机制</h3>
<p>工具执行器负责调用具体工具并处理结果：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// packages/core/src/tools/executor.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">class</span> <span class="nx">ToolExecutor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">tools</span>: <span class="kt">Map</span><span class="p">&lt;</span><span class="nt">string</span><span class="p">,</span> <span class="na">Tool</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="nx">tools</span>: <span class="kt">Tool</span><span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">tools</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">(</span><span class="nx">tools</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">tool</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nx">tool</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">tool</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="nx">execute</span><span class="p">(</span><span class="nx">toolName</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">params</span>: <span class="kt">any</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">tool</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tools</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="nx">toolName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">tool</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="sb">`未找到工具: </span><span class="si">${</span><span class="nx">toolName</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 验证参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">validateParameters</span><span class="p">(</span><span class="nx">tool</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 执行工具
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="k">await</span> <span class="nx">tool</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">validateParameters</span><span class="p">(</span><span class="nx">tool</span>: <span class="kt">Tool</span><span class="p">,</span> <span class="nx">params</span>: <span class="kt">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="p">[</span><span class="nx">name</span><span class="p">,</span> <span class="nx">param</span><span class="p">]</span> <span class="k">of</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">tool</span><span class="p">.</span><span class="nx">parameters</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">param</span><span class="p">.</span><span class="nx">required</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">params</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="sb">`缺少必需参数: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="模型接口层实现">模型接口层实现</h2>
<h3 id="api-调用封装">API 调用封装</h3>
<p>模型接口层封装了与 Qwen 模型的通信细节：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// packages/core/src/core/modelInterface.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="nx">axios</span> <span class="kr">from</span> <span class="s1">&#39;axios&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">ModelInterface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">apiKey</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">baseUrl</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">model</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="nx">config</span><span class="o">:</span> <span class="p">{</span><span class="nx">apiKey</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">baseUrl</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">model</span>: <span class="kt">string</span><span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">apiKey</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">apiKey</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">baseUrl</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">baseUrl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">model</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">model</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="nx">callModel</span><span class="p">(</span><span class="nx">context</span>: <span class="kt">any</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">baseUrl</span><span class="si">}</span><span class="sb">/models/</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="si">}</span><span class="sb">:generateContent`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">contents</span>: <span class="kt">context.history</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">tools</span>: <span class="kt">context.tools</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;Authorization&#39;</span><span class="o">:</span> <span class="sb">`Bearer </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">apiKey</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">);</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="sb">`模型调用失败: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="响应解析">响应解析</h3>
<p>处理模型返回的响应并提取有用信息：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// packages/core/src/core/responseParser.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">class</span> <span class="nx">ResponseParser</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">parseResponse</span><span class="p">(</span><span class="nx">response</span>: <span class="kt">any</span><span class="p">)</span><span class="o">:</span> <span class="nx">ParsedResponse</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 提取文本内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">candidates</span><span class="o">?</span><span class="p">.[</span><span class="mi">0</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">content</span><span class="o">?</span><span class="p">.</span><span class="nx">parts</span><span class="o">?</span><span class="p">.[</span><span class="mi">0</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">text</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 提取工具调用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">toolCalls</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">candidates</span><span class="o">?</span><span class="p">.[</span><span class="mi">0</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">content</span><span class="o">?</span><span class="p">.</span><span class="nx">parts</span>
</span></span><span class="line"><span class="cl">      <span class="o">?</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">part</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">part</span><span class="p">.</span><span class="nx">functionCall</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">?</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">part</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">part</span><span class="p">.</span><span class="nx">functionCall</span><span class="p">)</span> <span class="o">||</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">text</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">toolCalls</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="安全管理层实现">安全管理层实现</h2>
<h3 id="权限控制">权限控制</h3>
<p>实现细粒度的权限控制机制：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// packages/core/src/security/permission.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">class</span> <span class="nx">PermissionManager</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">permissions</span>: <span class="kt">Map</span><span class="p">&lt;</span><span class="nt">string</span><span class="p">,</span> <span class="na">string</span><span class="err">[]</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 默认权限配置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">permissions</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">      <span class="p">[</span><span class="s1">&#39;read_file&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;read&#39;</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">      <span class="p">[</span><span class="s1">&#39;write_file&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">      <span class="p">[</span><span class="s1">&#39;run_shell_command&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;execute&#39;</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// ... 其他工具权限
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="nx">checkPermission</span><span class="p">(</span><span class="nx">toolName</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">action</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="kr">boolean</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">toolPermissions</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">permissions</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="nx">toolName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">toolPermissions</span> <span class="o">?</span> <span class="nx">toolPermissions</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="沙箱机制">沙箱机制</h3>
<p>在隔离环境中执行潜在危险操作：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// packages/core/src/security/sandbox.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">class</span> <span class="nx">SandboxManager</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="nx">executeInSandbox</span><span class="p">(</span><span class="nx">command</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 创建隔离环境
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">sandbox</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">createSandbox</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 在沙箱中执行命令
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">sandbox</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">command</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 清理沙箱
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">destroySandbox</span><span class="p">(</span><span class="nx">sandbox</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="kr">async</span> <span class="nx">createSandbox</span><span class="p">()</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">Sandbox</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 实现沙箱创建逻辑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 可能涉及 Docker 容器、虚拟机或其他隔离技术
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="kr">async</span> <span class="nx">destroySandbox</span><span class="p">(</span><span class="nx">sandbox</span>: <span class="kt">Sandbox</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">void</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 实现沙箱销毁逻辑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="输入验证">输入验证</h3>
<p>对所有输入进行严格验证：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// packages/core/src/security/validator.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">class</span> <span class="nx">InputValidator</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">validatePath</span><span class="p">(</span><span class="nx">path</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="kr">boolean</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 检查路径是否合法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">path</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// 必须是绝对路径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// 禁止路径遍历
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 检查是否在允许的目录范围内
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">allowedPaths</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAllowedPaths</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">allowedPaths</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">allowed</span> <span class="o">=&gt;</span> <span class="nx">path</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="nx">allowed</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="nx">validateCommand</span><span class="p">(</span><span class="nx">command</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="kr">boolean</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 检查命令是否在允许列表中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">allowedCommands</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAllowedCommands</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">allowedCommands</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">allowed</span> <span class="o">=&gt;</span> <span class="nx">command</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="nx">allowed</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>安全性管理的整体架构如下：</p>
<div class="mermaid">

graph TD
    A[安全管理层] --> B[权限控制]
    A --> C[沙箱机制]
    A --> D[输入验证]
    
    B --> B1[工具权限检查]
    B --> B2[操作权限验证]
    
    C --> C1[隔离环境创建]
    C --> C2[命令安全执行]
    C --> C3[环境清理]
    
    D --> D1[路径合法性验证]
    D --> D2[命令合法性验证]
    D --> D3[参数完整性检查]
    
    B1 --> E[安全决策]
    B2 --> E
    C1 --> E
    C2 --> E
    C3 --> E
    D1 --> E
    D2 --> E
    D3 --> E
    
    E --> F[允许操作]
    E --> G[拒绝操作]

</div>
<h2 id="错误处理与日志记录">错误处理与日志记录</h2>
<h3 id="统一错误处理">统一错误处理</h3>
<p>实现统一的错误处理机制：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// packages/core/src/core/errorHandler.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">class</span> <span class="nx">ErrorHandler</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">handleError</span><span class="p">(</span><span class="nx">error</span>: <span class="kt">Error</span><span class="p">)</span><span class="o">:</span> <span class="nx">ErrorResponse</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 记录错误日志
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">logError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 根据错误类型返回相应响应
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span> <span class="k">instanceof</span> <span class="nx">ValidationError</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">type</span><span class="o">:</span> <span class="s1">&#39;validation_error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">message</span>: <span class="kt">error.message</span>
</span></span><span class="line"><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span> <span class="k">instanceof</span> <span class="nx">PermissionError</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">type</span><span class="o">:</span> <span class="s1">&#39;permission_error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">message</span>: <span class="kt">error.message</span>
</span></span><span class="line"><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 默认错误处理
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">type</span><span class="o">:</span> <span class="s1">&#39;unknown_error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;发生未知错误&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">logError</span><span class="p">(</span><span class="nx">error</span>: <span class="kt">Error</span><span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 记录错误到日志系统
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`[</span><span class="si">${</span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">()</span><span class="si">}</span><span class="sb">] ERROR: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="日志记录">日志记录</h3>
<p>使用结构化日志记录重要事件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// packages/core/src/core/logger.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="nx">debug</span> <span class="kr">from</span> <span class="s1">&#39;debug&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">Logger</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">logger</span>: <span class="kt">debug.Debugger</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="kr">namespace</span><span class="o">:</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">logger</span> <span class="o">=</span> <span class="nx">debug</span><span class="p">(</span><span class="sb">`qwen-code:</span><span class="si">${</span><span class="kr">namespace</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="nx">info</span><span class="p">(</span><span class="nx">message</span>: <span class="kt">string</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span>: <span class="kt">any</span><span class="p">[])</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">(</span><span class="sb">`INFO: </span><span class="si">${</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="nx">warn</span><span class="p">(</span><span class="nx">message</span>: <span class="kt">string</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span>: <span class="kt">any</span><span class="p">[])</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">(</span><span class="sb">`WARN: </span><span class="si">${</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="nx">error</span><span class="p">(</span><span class="nx">message</span>: <span class="kt">string</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span>: <span class="kt">any</span><span class="p">[])</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">(</span><span class="sb">`ERROR: </span><span class="si">${</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="性能优化策略">性能优化策略</h2>
<h3 id="缓存机制">缓存机制</h3>
<p>实现缓存以提高性能：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// packages/core/src/core/cache.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">class</span> <span class="nx">CacheManager</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">cache</span>: <span class="kt">Map</span><span class="p">&lt;</span><span class="nt">string</span><span class="p">,</span> <span class="p">{</span><span class="na">data</span><span class="err">:</span> <span class="na">any</span><span class="p">,</span> <span class="na">timestamp</span><span class="err">:</span> <span class="na">number</span><span class="p">}&gt;;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">ttl</span>: <span class="kt">number</span><span class="p">;</span> <span class="c1">// 缓存过期时间（毫秒）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="nx">ttl</span>: <span class="kt">number</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 默认5分钟
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">cache</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">ttl</span> <span class="o">=</span> <span class="nx">ttl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kr">get</span><span class="p">(</span><span class="nx">key</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="kt">any</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">item</span><span class="p">)</span> <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 检查是否过期
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">item</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">ttl</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">item</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kr">set</span><span class="p">(</span><span class="nx">key</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">data</span>: <span class="kt">any</span><span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="kr">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">timestamp</span>: <span class="kt">Date.now</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="nx">clear</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="异步处理">异步处理</h3>
<p>使用异步操作避免阻塞：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// packages/core/src/core/asyncProcessor.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">class</span> <span class="nx">AsyncProcessor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="nx">processTasks</span><span class="p">(</span><span class="nx">tasks</span>: <span class="kt">Array</span><span class="o">&lt;</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;</span><span class="o">&gt;</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">any</span><span class="err">[]</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 并行处理任务
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">task</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">executeWithRetry</span><span class="p">(</span><span class="nx">task</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="kr">async</span> <span class="nx">executeWithRetry</span><span class="p">(</span><span class="nx">task</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;,</span> <span class="nx">maxRetries</span>: <span class="kt">number</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">maxRetries</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">await</span> <span class="nx">task</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="nx">maxRetries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 等待后重试
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">await</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">(</span><span class="nx">resolve</span> <span class="o">=&gt;</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="扩展机制">扩展机制</h2>
<h3 id="插件系统">插件系统</h3>
<p>支持插件扩展功能：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// packages/core/src/plugins/pluginManager.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">class</span> <span class="nx">PluginManager</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">plugins</span>: <span class="kt">Map</span><span class="p">&lt;</span><span class="nt">string</span><span class="p">,</span> <span class="na">Plugin</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">plugins</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="nx">registerPlugin</span><span class="p">(</span><span class="nx">plugin</span>: <span class="kt">Plugin</span><span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="kr">set</span><span class="p">(</span><span class="nx">plugin</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">plugin</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 初始化插件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">.</span><span class="nx">initialize</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">plugin</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="nx">getPlugin</span><span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="nx">Plugin</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="nx">getAllPlugins</span><span class="p">()</span><span class="o">:</span> <span class="nx">Plugin</span><span class="p">[]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">values</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">Plugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">initialize</span><span class="o">?:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 插件可以扩展的功能点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><h3 id="配置扩展">配置扩展</h3>
<p>支持通过配置文件扩展功能：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// packages/core/src/config/extendedConfig.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">interface</span> <span class="nx">ExtendedConfig</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 基础配置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">apiKey</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">baseUrl</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">model</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1">// 扩展配置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">plugins?</span>: <span class="kt">string</span><span class="p">[];</span> <span class="c1">// 插件列表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">customTools?</span>: <span class="kt">string</span><span class="p">[];</span> <span class="c1">// 自定义工具路径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">security</span><span class="o">?:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">allowedPaths?</span>: <span class="kt">string</span><span class="p">[];</span> <span class="c1">// 允许访问的路径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">allowedCommands?</span>: <span class="kt">string</span><span class="p">[];</span> <span class="c1">// 允许执行的命令
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="总结">总结</h2>
<p>Qwen Code 的实现框架是一个复杂而精巧的系统，它将 AI 能力与本地开发环境无缝集成。通过分层架构设计、统一接口、安全机制和扩展性考虑，Qwen Code 为用户提供了一个强大而安全的 AI 驱动开发工具。</p>
<p>理解 Qwen Code 的实现框架不仅有助于更好地使用这个工具，也为开发类似系统提供了有价值的参考。随着 AI 技术的不断发展，这样的工具将在未来的软件开发中发挥越来越重要的作用。</p>

          </div>

          
          <div class="row">
            <div class="col-md-8">
            
              <div class="mb-5">
                
<div class="li-x div-x post-meta">
  <li class="pr-0"><a href="https://blog.jaxiu.cn/tags/"><i class="fas fa-tags"></i></a></li>
  <div class="tags-sm">
    
      <li><a href="https://blog.jaxiu.cn/tags/qwen-code" role="button">Qwen Code </a></li>
      
    
      <li><a href="https://blog.jaxiu.cn/tags/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1" role="button">架构设计 </a></li>
      
    
      <li><a href="https://blog.jaxiu.cn/tags/%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86" role="button">实现原理 </a></li>
      
    
      <li><a href="https://blog.jaxiu.cn/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90" role="button">源码解析 </a></li>
      
    
  </div>
</div>
              </div>
            
            </div>
            
          </div>
          

          
          <div class="row pt-3">
            <div class="col-md-6">
              
                <a href=https://blog.jaxiu.cn/blog/2025-07/qwen-code-project-structure/ class="post-meta">Previous
                  <div class="pt-2 pb-5 d-flex">
                    <i class="fas fa-angle-left text-grey font-weight-bold mr-2 active-color"></i>
                    <span>Qwen Code 项目框架详解</span>
                  </div>
                </a>
              
            </div>
            
            <div class="col-md-6 text-right" >
              
                <a href=https://blog.jaxiu.cn/blog/2025-07/qwen-code-core-implementation-details/ class="post-meta">Next
                  <div class="pt-2 pb-5 flex-reverse">
                    <i class="fas fa-angle-right text-grey font-weight-bold ml-2 active-color"></i>
                    <span>Qwen Code 核心代码实现细节深度解读</span>
                  </div>
                </a>
              
            </div>
          </div>

          

        </div>
        

      </div>
      

      

    </div>
    


  </main>
  


    
    
<footer class="page-footer text-center font-small mt-4 wow fadeIn">


  
  <div class="pb-2 mt-5 pt-5">
    
    <a href="//github.com/axfinn " target="_blank" rel="noopener"><i class="fab fa-github mr-3"
        aria-hidden="true"></i></a>
    
    

    

    

    

    

    


    
    <a href="mailto:521very@email.com"><i class="far fa-envelope-open mr-3" aria-hidden="true"></i></a>
    

    

    

  </div>
  

  
  <div class="copyright py-4">
    
    <span> 2016 - 2026 &copy; | Theme <a href='https://github.com/orianna-zzo/AllinOne'
        target="_blank">AllinOne</a> by <a href='https://github.com/orianna-zzo' target="_blank">Orianna</a> </span>
  </div>
  

</footer>

    




<script type="text/javascript" src="https://blog.jaxiu.cn/js/vendors/jquery/jquery-3.3.1.min.js"></script>

<script type="text/javascript" src="https://blog.jaxiu.cn/js/vendors/jquery/jquery.smooth-scroll.min.js"></script>



<script type="text/javascript" src="https://blog.jaxiu.cn/js/vendors/popper.min.js"></script>
<script type="text/javascript" src="https://blog.jaxiu.cn/js/vendors/holder.min.js"></script>
<script type="text/javascript" src="https://blog.jaxiu.cn/js/vendors-extensions/bootstrap4/bootstrap.js"></script>

<script type="text/javascript" src="https://blog.jaxiu.cn/js/vendors/mdb/mdb.min.js"></script>

<script type="text/javascript" src="https://blog.jaxiu.cn/js/main.js"></script>




<script src="https://blog.jaxiu.cn/js/vendors/highlight.pack.js"> </script>
<script>hljs.initHighlightingOnLoad();</script>





<script src="https://blog.jaxiu.cn/js/vendors/katex/katex.min.js"> </script>
<script src="https://blog.jaxiu.cn/js/vendors/katex/contrib/auto-render.min.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body);
  });
</script>








<script type="text/javascript">
  
  new WOW().init();
</script>
  </body>
</html>